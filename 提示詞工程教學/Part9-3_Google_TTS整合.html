<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9-3 Google TTS èªéŸ³åˆæˆ - èªéŸ³è©•èªç³»çµ±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0c1445 0%, #1a237e 50%, #283593 100%);
            min-height: 100vh;
            overflow: hidden;
            color: #333;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-image:
                radial-gradient(2px 2px at 20px 30px, white, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent);
            background-size: 550px 250px;
            animation: twinkle 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }

        .nav-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: rgba(26, 35, 126, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            z-index: 10000;
        }
        .nav-title {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, #0277bd, #039be5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-buttons { display: flex; gap: 12px; }
        .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .nav-btn:hover {
            background: rgba(2, 119, 189, 0.3);
            border-color: #0277bd;
        }

        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(26, 35, 126, 0.8);
            color: white;
            width: 60px; height: 60px;
            border-radius: 50%;
            border: 2px solid rgba(2, 119, 189, 0.5);
            font-size: 24px;
            cursor: pointer;
            z-index: 9000;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nav-arrow:hover {
            background: rgba(57, 73, 171, 0.9);
            transform: translateY(-50%) scale(1.1);
        }
        .prev-arrow { left: 30px; }
        .next-arrow { right: 30px; }
        .nav-arrow:disabled { opacity: 0.3; cursor: not-allowed; }

        .slide-container {
            width: 100%;
            height: 100vh;
            padding-top: 60px;
            position: relative;
            z-index: 1;
        }
        .slide {
            position: absolute;
            top: 60px; left: 0;
            width: 100%;
            height: calc(100vh - 60px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 40px;
            opacity: 0;
            transition: opacity 0.4s ease;
            z-index: 10;
        }
        .slide.active {
            display: flex;
            opacity: 1;
            z-index: 20;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            padding: 35px 45px;
            max-width: 1400px;
            width: 96%;
            max-height: 88vh;
            overflow-y: auto;
            position: relative;
        }

        h1 {
            font-size: 38px;
            margin-bottom: 15px;
            text-align: center;
            background: linear-gradient(135deg, #0277bd, #039be5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        h2 {
            color: #0277bd;
            font-size: 28px;
            margin-bottom: 20px;
            border-bottom: 4px solid;
            border-image: linear-gradient(90deg, #0277bd, #039be5) 1;
            padding-bottom: 10px;
        }
        h3 { color: #01579b; font-size: 20px; margin: 18px 0 10px 0; }
        h4 { color: #0277bd; font-size: 17px; margin: 12px 0 8px 0; }

        p, li {
            font-size: 16px;
            line-height: 1.7;
            color: #444;
            margin-bottom: 8px;
        }
        ul, ol { margin-left: 25px; margin-bottom: 12px; }

        .prompt-box {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 3px solid #ff6f00;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            position: relative;
        }
        .prompt-box::before {
            content: 'AI æç¤ºè©';
            position: absolute;
            top: -12px;
            left: 20px;
            background: #ff6f00;
            color: white;
            padding: 4px 15px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
        }
        .prompt-box pre {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            margin: 10px 0 0 0;
            border: 1px solid #ffcc80;
        }

        .code-box {
            background: linear-gradient(135deg, #1a237e, #283593);
            color: #e8eaf6;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            margin: 15px 0;
            overflow-x: auto;
            position: relative;
        }
        .code-box::before {
            content: 'GAS ç¨‹å¼ç¢¼';
            position: absolute;
            top: -12px;
            left: 20px;
            background: #0277bd;
            color: white;
            padding: 4px 15px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
        }
        .code-box .comment { color: #81c784; }
        .code-box .keyword { color: #64b5f6; }
        .code-box .string { color: #ffb74d; }
        .code-box .function { color: #ce93d8; }

        .highlight-box {
            background: linear-gradient(135deg, #e1f5fe, #b3e5fc);
            border-left: 5px solid #0277bd;
            padding: 18px 22px;
            border-radius: 0 15px 15px 0;
            margin: 15px 0;
        }
        .highlight-box h4 { color: #0277bd; margin-top: 0; }

        .step-box {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-left: 5px solid #4caf50;
            padding: 18px 22px;
            border-radius: 0 15px 15px 0;
            margin: 15px 0;
        }
        .step-box h4 { color: #2e7d32; margin-top: 0; }

        .warning-box {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border-left: 5px solid #ff6f00;
            padding: 18px 22px;
            border-radius: 0 15px 15px 0;
            margin: 15px 0;
        }
        .warning-box h4 { color: #e65100; margin-top: 0; }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 15px 0;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .card {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            border-top: 4px solid #0277bd;
        }
        .card.orange { border-top-color: #ff6f00; }
        .card.green { border-top-color: #4caf50; }
        .card h4 { margin-top: 0; }

        .tag {
            display: inline-block;
            background: #0277bd;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        .tag.orange { background: #ff6f00; }
        .tag.green { background: #4caf50; }
        .tag.red { background: #d32f2f; }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .copy-btn:hover { background: rgba(255,255,255,0.3); }

        .progress-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 9999;
        }
        .progress-dot {
            width: 12px; height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s;
        }
        .progress-dot.active {
            background: #0277bd;
            transform: scale(1.3);
        }

        @media (max-width: 900px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .content-card { padding: 20px; }
            h1 { font-size: 28px; }
            h2 { font-size: 22px; }
        }
    </style>
</head>
<body>
    <nav class="nav-bar">
        <div class="nav-title">9-3 Google TTS èªéŸ³åˆæˆ</div>
        <div class="nav-buttons">
            <a href="index2.html" class="nav-btn">é¦–é </a>
            <button class="nav-btn" onclick="toggleFullscreen()">å…¨è¢å¹•</button>
            <a href="https://www.youtube.com/@Liang-yt02" target="_blank" class="nav-btn">YT</a>
            <a href="https://www.facebook.com/?locale=zh_TW" target="_blank" class="nav-btn">FB</a>
            <a href="https://www.facebook.com/groups/2754139931432955?locale=zh_TW" target="_blank" class="nav-btn">3A</a>
        </div>
    </nav>

    <button class="nav-arrow prev-arrow" onclick="prevSlide()">â†</button>
    <button class="nav-arrow next-arrow" onclick="nextSlide()">â†’</button>

    <div class="slide-container">
        <!-- Slide 1: æ¨™é¡Œé  -->
        <div class="slide active">
            <div class="content-card" style="text-align: center;">
                <div style="margin-bottom: 25px;">
                    <span class="tag">Part 9-3</span>
                    <span class="tag orange">èªéŸ³åˆæˆ</span>
                    <span class="tag red">å®Œæ•´å¯¦ä½œ</span>
                </div>
                <h1>Google TTS èªéŸ³åˆæˆ</h1>
                <p style="font-size: 20px; color: #0277bd; margin: 25px 0;">
                    å°‡è©•èªè½‰æ›æˆæœ‰æº«åº¦çš„èªéŸ³æª”æ¡ˆ
                </p>

                <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #e1f5fe, #b3e5fc); border-radius: 15px;">
                    <p style="font-size: 18px; margin: 0 0 15px 0;">å®Œæˆå¾Œçš„æ•ˆæœï¼š</p>
                    <div style="background: #fff; padding: 20px; border-radius: 10px; text-align: left;">
                        <p style="margin: 0;"><strong>ã€å››å­—è©•èªã€‘</strong>æ¢ç´¢æœªçŸ¥ãƒ»å‹‡æ–¼å˜—è©¦</p>
                        <p style="margin: 10px 0 0 0;"><strong>ã€è€å¸«å›é¥‹ã€‘</strong>ä½ çš„å ±å‘Šå±•ç¾äº†...</p>
                        <p style="margin: 10px 0 0 0;"><strong>ã€èªéŸ³ç‰ˆæœ¬ã€‘</strong>ğŸ”Š é»æ“Šæ’­æ”¾</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 2: Google TTS æ–¹æ¡ˆé¸æ“‡ -->
        <div class="slide">
            <div class="content-card">
                <h2>Google TTS æ–¹æ¡ˆé¸æ“‡</h2>

                <div class="grid-2">
                    <div class="card">
                        <h4 style="color: #0277bd;">æ–¹æ¡ˆ Aï¼šGoogle Cloud TTS API</h4>
                        <p><strong>å„ªé»ï¼š</strong></p>
                        <ul>
                            <li>èªéŸ³å“è³ªæœ€ä½³</li>
                            <li>å¤šç¨®èªéŸ³å¯é¸</li>
                            <li>å¯èª¿æ•´èªé€Ÿã€éŸ³èª¿</li>
                        </ul>
                        <p><strong>ç¼ºé»ï¼š</strong></p>
                        <ul>
                            <li>éœ€è¦è¨­å®š GCP å°ˆæ¡ˆ</li>
                            <li>éœ€è¦å•Ÿç”¨å¸³å–®ï¼ˆæœ‰å…è²»é¡åº¦ï¼‰</li>
                        </ul>
                        <p><strong>è²»ç”¨ï¼š</strong>æ¯æœˆå…è²» 100 è¬å­—å…ƒ</p>
                    </div>
                    <div class="card green">
                        <h4 style="color: #4caf50;">æ–¹æ¡ˆ Bï¼šWeb Speech APIï¼ˆç€è¦½å™¨ï¼‰</h4>
                        <p><strong>å„ªé»ï¼š</strong></p>
                        <ul>
                            <li>å®Œå…¨å…è²»</li>
                            <li>ç„¡éœ€é¡å¤–è¨­å®š</li>
                            <li>å‰ç«¯å³å¯ä½¿ç”¨</li>
                        </ul>
                        <p><strong>ç¼ºé»ï¼š</strong></p>
                        <ul>
                            <li>åªèƒ½åœ¨ç€è¦½å™¨æ’­æ”¾</li>
                            <li>ç„¡æ³•ç”Ÿæˆ MP3 æª”æ¡ˆ</li>
                        </ul>
                        <p><strong>é©åˆï¼š</strong>ç¶²é å³æ™‚æ’­æ”¾</p>
                    </div>
                </div>

                <div class="highlight-box">
                    <h4>æœ¬èª²ç¨‹æ¨è–¦</h4>
                    <p style="margin-bottom: 0;">ä½¿ç”¨ <strong>æ–¹æ¡ˆ Aï¼ˆGoogle Cloud TTSï¼‰</strong>ï¼Œå¯ä»¥ç”Ÿæˆ MP3 æª”æ¡ˆå„²å­˜åˆ° Google Driveï¼Œå­¸ç”Ÿå¯ä»¥ä¸‹è¼‰é‡è¤‡è†è½ã€‚</p>
                </div>
            </div>
        </div>

        <!-- Slide 3: è«‹ AI å¹«å¯« TTS ç¨‹å¼ç¢¼ -->
        <div class="slide">
            <div class="content-card">
                <h2>Step 1ï¼šè«‹ AI å¹«å¯« Google Cloud TTS ç¨‹å¼ç¢¼</h2>

                <div class="prompt-box">
                    <p style="margin: 0 0 10px 0;"><strong>è¤‡è£½é€™æ®µæç¤ºè©çµ¦ ChatGPT æˆ– Claudeï¼š</strong></p>
                    <pre>è«‹å¹«æˆ‘å¯« Google Apps Script å‡½æ•¸ï¼Œä½¿ç”¨ Google Cloud Text-to-Speech APIï¼š

1. å‡½æ•¸åç¨±ï¼šgenerateSpeech(text)
2. ä½¿ç”¨å°ç£ä¸­æ–‡èªéŸ³ï¼ˆcmn-TWï¼‰
3. å°‡ç”Ÿæˆçš„ MP3 éŸ³æª”å­˜åˆ° Google Drive æŒ‡å®šè³‡æ–™å¤¾
4. å›å‚³éŸ³æª”çš„ Google Drive é€£çµ

éœ€è¦çš„è¨­å®šï¼š
- GOOGLE_CLOUD_API_KEY
- DRIVE_FOLDER_IDï¼ˆå­˜æ”¾éŸ³æª”çš„è³‡æ–™å¤¾ï¼‰

èªéŸ³åƒæ•¸ï¼š
- èªé€Ÿï¼š1.0ï¼ˆæ­£å¸¸é€Ÿåº¦ï¼‰
- éŸ³èª¿ï¼š0ï¼ˆæ­£å¸¸éŸ³èª¿ï¼‰
- æ ¼å¼ï¼šMP3

è«‹åŠ ä¸Šä¸­æ–‡è¨»è§£ï¼Œä¸¦æä¾›æ¸¬è©¦å‡½æ•¸ã€‚</pre>
                </div>

                <div class="step-box">
                    <h4>å‰ç½®æº–å‚™</h4>
                    <ol style="margin-bottom: 0;">
                        <li>å‰å¾€ Google Cloud Consoleï¼ˆconsole.cloud.google.comï¼‰</li>
                        <li>å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ</li>
                        <li>å•Ÿç”¨ã€ŒCloud Text-to-Speech APIã€</li>
                        <li>å»ºç«‹ API Key ä¸¦è¤‡è£½</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Slide 4: TTS æ ¸å¿ƒç¨‹å¼ç¢¼ -->
        <div class="slide">
            <div class="content-card">
                <h2>Step 2ï¼šGoogle Cloud TTS ç¨‹å¼ç¢¼</h2>

                <div class="code-box">
                    <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<span class="comment">// ===== Google Cloud TTS è¨­å®š =====</span>
<span class="keyword">const</span> GOOGLE_CLOUD_API_KEY = <span class="string">'ä½ çš„ Google Cloud API Key'</span>;
<span class="keyword">const</span> DRIVE_FOLDER_ID = <span class="string">'å­˜æ”¾éŸ³æª”çš„è³‡æ–™å¤¾ ID'</span>;

<span class="comment">// ===== ç”ŸæˆèªéŸ³æª”æ¡ˆ =====</span>
<span class="keyword">function</span> <span class="function">generateSpeech</span>(text, fileName) {
  <span class="keyword">const</span> url = <span class="string">`https://texttospeech.googleapis.com/v1/text:synthesize?key=${GOOGLE_CLOUD_API_KEY}`</span>;

  <span class="keyword">const</span> payload = {
    input: { text: text },
    voice: {
      languageCode: <span class="string">'cmn-TW'</span>,           <span class="comment">// å°ç£ä¸­æ–‡</span>
      name: <span class="string">'cmn-TW-Standard-A'</span>,        <span class="comment">// å¥³è²ï¼ˆB ç‚ºç”·è²ï¼‰</span>
      ssmlGender: <span class="string">'FEMALE'</span>
    },
    audioConfig: {
      audioEncoding: <span class="string">'MP3'</span>,
      speakingRate: 1.0,                 <span class="comment">// èªé€Ÿï¼ˆ0.5-2.0ï¼‰</span>
      pitch: 0.0                         <span class="comment">// éŸ³èª¿ï¼ˆ-10 è‡³ 10ï¼‰</span>
    }
  };

  <span class="keyword">const</span> options = {
    method: <span class="string">'post'</span>,
    contentType: <span class="string">'application/json'</span>,
    payload: <span class="function">JSON.stringify</span>(payload),
    muteHttpExceptions: <span class="keyword">true</span>
  };

  <span class="keyword">try</span> {
    <span class="keyword">const</span> response = <span class="function">UrlFetchApp.fetch</span>(url, options);
    <span class="keyword">const</span> result = <span class="function">JSON.parse</span>(response.<span class="function">getContentText</span>());

    <span class="comment">// å°‡ Base64 éŸ³è¨Šè½‰ç‚º Blob</span>
    <span class="keyword">const</span> audioContent = result.audioContent;
    <span class="keyword">const</span> audioBlob = Utilities.<span class="function">newBlob</span>(
      Utilities.<span class="function">base64Decode</span>(audioContent),
      <span class="string">'audio/mp3'</span>,
      fileName + <span class="string">'.mp3'</span>
    );

    <span class="comment">// å„²å­˜åˆ° Google Drive</span>
    <span class="keyword">const</span> folder = DriveApp.<span class="function">getFolderById</span>(DRIVE_FOLDER_ID);
    <span class="keyword">const</span> file = folder.<span class="function">createFile</span>(audioBlob);
    file.<span class="function">setSharing</span>(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);

    <span class="keyword">return</span> file.<span class="function">getUrl</span>();
  } <span class="keyword">catch</span> (error) {
    <span class="function">console.error</span>(<span class="string">'TTS éŒ¯èª¤ï¼š'</span>, error);
    <span class="keyword">return</span> <span class="keyword">null</span>;
  }
}
                </div>
            </div>
        </div>

        <!-- Slide 5: æ•´åˆè©•èªèˆ‡èªéŸ³ -->
        <div class="slide">
            <div class="content-card">
                <h2>Step 3ï¼šæ•´åˆè©•èªç”Ÿæˆèˆ‡èªéŸ³åˆæˆ</h2>

                <div class="code-box">
                    <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<span class="comment">// ===== å®Œæ•´æµç¨‹ï¼šè©•èª + èªéŸ³ =====</span>
<span class="keyword">function</span> <span class="function">generateFeedbackWithVoice</span>(content, userId) {
  <span class="comment">// 1. ç”Ÿæˆ AI è©•èª</span>
  <span class="keyword">const</span> aiResponse = <span class="function">generateFullFeedback</span>(content);
  <span class="keyword">const</span> parsed = <span class="function">parseFeedback</span>(aiResponse);

  <span class="comment">// 2. çµ„åˆè¦è½‰èªéŸ³çš„æ–‡å­—</span>
  <span class="keyword">const</span> speechText = <span class="string">`
    è©•èªï¼š${parsed.fourChar}ã€‚
    è€å¸«å›é¥‹ï¼š${parsed.feedback}
  `</span>.<span class="function">trim</span>();

  <span class="comment">// 3. ç”ŸæˆèªéŸ³æª”æ¡ˆ</span>
  <span class="keyword">const</span> fileName = <span class="string">`è©•èª_${userId}_${Date.now()}`</span>;
  <span class="keyword">const</span> audioUrl = <span class="function">generateSpeech</span>(speechText, fileName);

  <span class="comment">// 4. å„²å­˜åˆ° Sheet</span>
  <span class="function">saveToSheetComplete</span>(userId, content, parsed.fourChar, parsed.feedback, audioUrl);

  <span class="comment">// 5. å›å‚³å®Œæ•´è¨Šæ¯</span>
  <span class="keyword">return</span> {
    fourChar: parsed.fourChar,
    feedback: parsed.feedback,
    audioUrl: audioUrl
  };
}

<span class="comment">// ===== å„²å­˜å®Œæ•´è³‡æ–™åˆ° Sheet =====</span>
<span class="keyword">function</span> <span class="function">saveToSheetComplete</span>(userId, content, fourChar, feedback, audioUrl) {
  <span class="keyword">const</span> ss = SpreadsheetApp.<span class="function">openById</span>(SPREADSHEET_ID);
  <span class="keyword">const</span> sheet = ss.<span class="function">getSheetByName</span>(SHEET_NAME);

  sheet.<span class="function">appendRow</span>([
    <span class="keyword">new</span> <span class="function">Date</span>(),              <span class="comment">// A: æ™‚é–“</span>
    userId,                     <span class="comment">// B: LINE ID</span>
    content.<span class="function">substring</span>(0, 500), <span class="comment">// C: ä½œå“å…§å®¹</span>
    fourChar,                   <span class="comment">// D: å››å­—è©•èª</span>
    feedback,                   <span class="comment">// E: æ–‡å­—å›é¥‹</span>
    audioUrl || <span class="string">''</span>              <span class="comment">// F: èªéŸ³é€£çµ</span>
  ]);
}
                </div>
            </div>
        </div>

        <!-- Slide 6: æ ¼å¼åŒ– LINE è¨Šæ¯ -->
        <div class="slide">
            <div class="content-card">
                <h2>Step 4ï¼šæ ¼å¼åŒ– LINE å›è¦†è¨Šæ¯</h2>

                <div class="code-box">
                    <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<span class="comment">// ===== æ ¼å¼åŒ–å®Œæ•´å›è¦†è¨Šæ¯ =====</span>
<span class="keyword">function</span> <span class="function">formatCompleteMessage</span>(result) {
  <span class="keyword">let</span> message = <span class="string">`
ã€å››å­—è©•èªã€‘
${result.fourChar}

ã€è€å¸«å›é¥‹ã€‘
${result.feedback}
`</span>.<span class="function">trim</span>();

  <span class="comment">// å¦‚æœæœ‰èªéŸ³é€£çµï¼ŒåŠ å…¥è¨Šæ¯</span>
  <span class="keyword">if</span> (result.audioUrl) {
    message += <span class="string">`

ã€èªéŸ³ç‰ˆæœ¬ã€‘
${result.audioUrl}`</span>;
  }

  <span class="keyword">return</span> message;
}

<span class="comment">// ===== å®Œæ•´è™•ç†æµç¨‹ï¼ˆå«èªéŸ³ï¼‰=====</span>
<span class="keyword">function</span> <span class="function">handleMessageWithVoice</span>(event) {
  <span class="keyword">const</span> userId = event.source.userId;
  <span class="keyword">const</span> replyToken = event.replyToken;
  <span class="keyword">const</span> content = event.message.text;

  <span class="comment">// ç”Ÿæˆè©•èªèˆ‡èªéŸ³</span>
  <span class="keyword">const</span> result = <span class="function">generateFeedbackWithVoice</span>(content, userId);

  <span class="comment">// æ ¼å¼åŒ–è¨Šæ¯</span>
  <span class="keyword">const</span> message = <span class="function">formatCompleteMessage</span>(result);

  <span class="comment">// å›è¦† LINE</span>
  <span class="function">replyMessage</span>(replyToken, message);
}
                </div>

                <div class="highlight-box">
                    <h4>æœ€çµ‚æ•ˆæœ</h4>
                    <div style="background: #fff; padding: 15px; border-radius: 10px; font-family: monospace;">
                        <p>ã€å››å­—è©•èªã€‘<br>æ¢ç´¢æœªçŸ¥ãƒ»å‹‡æ–¼å˜—è©¦</p>
                        <p>ã€è€å¸«å›é¥‹ã€‘<br>ä½ çš„å ±å‘Šå±•ç¾äº†å°ç«æ˜Ÿæ¢æ¸¬çš„æ·±å…¥ç†è§£...</p>
                        <p>ã€èªéŸ³ç‰ˆæœ¬ã€‘<br>https://drive.google.com/file/d/xxx</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 7: æ›¿ä»£æ–¹æ¡ˆ - å…è²» TTS -->
        <div class="slide">
            <div class="content-card">
                <h2>æ›¿ä»£æ–¹æ¡ˆï¼šå®Œå…¨å…è²»çš„ç€è¦½å™¨ TTS</h2>

                <p>å¦‚æœä¸æƒ³è¨­å®š Google Cloudï¼Œå¯ä»¥ç”¨ç¶²é å‰ç«¯å¯¦ç¾å³æ™‚èªéŸ³æ’­æ”¾ï¼š</p>

                <div class="code-box" style="background: linear-gradient(135deg, #4a148c, #7b1fa2);">
                    <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
                    <span style="color: #ce93d8; font-size: 12px;">HTML + JavaScript</span>
<span class="comment">// ===== ç¶²é  TTS æ’­æ”¾æŒ‰éˆ• =====</span>

&lt;!-- HTML éƒ¨åˆ† --&gt;
&lt;button onclick="<span class="function">speakFeedback</span>()"&gt;ğŸ”Š æ’­æ”¾è©•èª&lt;/button&gt;

&lt;script&gt;
<span class="comment">// è©•èªå…§å®¹</span>
<span class="keyword">const</span> feedbackText = <span class="string">"è©•èªï¼šæ¢ç´¢æœªçŸ¥ï¼Œå‹‡æ–¼å˜—è©¦ã€‚è€å¸«å›é¥‹ï¼šä½ çš„å ±å‘Šå±•ç¾äº†..."</span>;

<span class="comment">// æ’­æ”¾èªéŸ³</span>
<span class="keyword">function</span> <span class="function">speakFeedback</span>() {
  <span class="keyword">const</span> utterance = <span class="keyword">new</span> <span class="function">SpeechSynthesisUtterance</span>(feedbackText);
  utterance.lang = <span class="string">'zh-TW'</span>;      <span class="comment">// å°ç£ä¸­æ–‡</span>
  utterance.rate = 1.0;           <span class="comment">// èªé€Ÿ</span>
  utterance.pitch = 1.0;          <span class="comment">// éŸ³èª¿</span>

  window.speechSynthesis.<span class="function">speak</span>(utterance);
}
&lt;/script&gt;
                </div>

                <div class="warning-box">
                    <h4>æ³¨æ„äº‹é …</h4>
                    <ul style="margin-bottom: 0;">
                        <li>Web Speech API åªèƒ½åœ¨ç€è¦½å™¨ä¸­æ’­æ”¾ï¼Œç„¡æ³•ç”Ÿæˆæª”æ¡ˆ</li>
                        <li>é©åˆç”¨æ–¼è©•é‡ç¶²ç«™çš„å³æ™‚æ’­æ”¾åŠŸèƒ½</li>
                        <li>ä¸åŒç€è¦½å™¨çš„èªéŸ³å¯èƒ½ç•¥æœ‰å·®ç•°</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 8: æ¸¬è©¦å‡½æ•¸ -->
        <div class="slide">
            <div class="content-card">
                <h2>Step 5ï¼šæ¸¬è©¦å‡½æ•¸</h2>

                <div class="code-box">
                    <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<span class="comment">// ===== æ¸¬è©¦ TTS ç”Ÿæˆ =====</span>
<span class="keyword">function</span> <span class="function">testGenerateSpeech</span>() {
  <span class="keyword">const</span> testText = <span class="string">'è©•èªï¼šæ¢ç´¢æœªçŸ¥ï¼Œå‹‡æ–¼å˜—è©¦ã€‚è€å¸«å›é¥‹ï¼šä½ çš„ç«æ˜Ÿæ¢æ¸¬å ±å‘Šå±•ç¾äº†å°ç§‘å­¸æ¢ç©¶çš„ç†±æƒ…ã€‚'</span>;

  <span class="keyword">const</span> audioUrl = <span class="function">generateSpeech</span>(testText, <span class="string">'test_feedback'</span>);

  <span class="keyword">if</span> (audioUrl) {
    <span class="function">console.log</span>(<span class="string">'âœ… TTS æˆåŠŸï¼'</span>);
    <span class="function">console.log</span>(<span class="string">'éŸ³æª”é€£çµï¼š'</span> + audioUrl);
  } <span class="keyword">else</span> {
    <span class="function">console.log</span>(<span class="string">'âŒ TTS å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key è¨­å®š'</span>);
  }
}

<span class="comment">// ===== æ¸¬è©¦å®Œæ•´æµç¨‹ =====</span>
<span class="keyword">function</span> <span class="function">testCompleteFlow</span>() {
  <span class="keyword">const</span> testContent = <span class="string">`é€™æ˜¯æˆ‘å°ç«æ˜Ÿæ¢æ¸¬ä»»å‹™çš„å­¸ç¿’å¿ƒå¾—ï¼š
ç«æ˜Ÿæ¢æ¸¬è»Šæ¯…åŠ›è™Ÿä½¿ç”¨æ ¸èƒ½é›»æ± ï¼Œå› ç‚ºç«æ˜Ÿä¸Šçš„å¤ªé™½èƒ½ä¸å¤ ç©©å®šã€‚`</span>;

  <span class="keyword">const</span> result = <span class="function">generateFeedbackWithVoice</span>(testContent, <span class="string">'TEST_USER'</span>);

  <span class="function">console.log</span>(<span class="string">'===== æ¸¬è©¦çµæœ ====='</span>);
  <span class="function">console.log</span>(<span class="string">'å››å­—è©•èªï¼š'</span> + result.fourChar);
  <span class="function">console.log</span>(<span class="string">'æ–‡å­—å›é¥‹ï¼š'</span> + result.feedback);
  <span class="function">console.log</span>(<span class="string">'èªéŸ³é€£çµï¼š'</span> + result.audioUrl);

  <span class="keyword">const</span> message = <span class="function">formatCompleteMessage</span>(result);
  <span class="function">console.log</span>(<span class="string">'===== LINE è¨Šæ¯ ====='</span>);
  <span class="function">console.log</span>(message);
}
                </div>

                <div class="step-box">
                    <h4>åŸ·è¡Œæ¸¬è©¦</h4>
                    <ol style="margin-bottom: 0;">
                        <li>å…ˆåŸ·è¡Œ <code>testGenerateSpeech</code> ç¢ºèª TTS æ­£å¸¸</li>
                        <li>æª¢æŸ¥ Google Drive æ˜¯å¦æœ‰æ–°å¢éŸ³æª”</li>
                        <li>å†åŸ·è¡Œ <code>testCompleteFlow</code> æ¸¬è©¦å®Œæ•´æµç¨‹</li>
                        <li>æª¢æŸ¥ Sheet æ˜¯å¦æœ‰æ–°å¢è³‡æ–™</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Slide 9: å®Œæ•´ç¨‹å¼ç¢¼æ•´åˆ -->
        <div class="slide">
            <div class="content-card">
                <h2>å®Œæ•´ç¨‹å¼ç¢¼æ•´åˆ</h2>

                <div class="highlight-box">
                    <h4>æœ€çµ‚ doPost å‡½æ•¸</h4>
                    <p>å°‡åŸæœ¬çš„ <code>handleMessage</code> æ”¹ç‚º <code>handleMessageWithVoice</code>ï¼š</p>
                </div>

                <div class="code-box">
                    <button class="copy-btn" onclick="copyCode(this)">è¤‡è£½</button>
<span class="comment">// ===== æœ€çµ‚ç‰ˆæœ¬çš„ Webhook å…¥å£ =====</span>
<span class="keyword">function</span> <span class="function">doPost</span>(e) {
  <span class="keyword">try</span> {
    <span class="keyword">const</span> data = <span class="function">JSON.parse</span>(e.postData.contents);
    <span class="keyword">const</span> events = data.events;

    <span class="keyword">for</span> (<span class="keyword">const</span> event <span class="keyword">of</span> events) {
      <span class="keyword">if</span> (event.type === <span class="string">'message'</span> && event.message.type === <span class="string">'text'</span>) {
        <span class="comment">// ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬ï¼ˆå«èªéŸ³ï¼‰</span>
        <span class="function">handleMessageWithVoice</span>(event);
      }
    }

    <span class="keyword">return</span> ContentService.<span class="function">createTextOutput</span>(<span class="string">'OK'</span>);
  } <span class="keyword">catch</span> (error) {
    <span class="function">console.error</span>(<span class="string">'doPost error:'</span>, error);
    <span class="keyword">return</span> ContentService.<span class="function">createTextOutput</span>(<span class="string">'Error'</span>);
  }
}
                </div>

                <div class="grid-2">
                    <div class="card">
                        <h4>Sheet æœ€çµ‚æ¬„ä½</h4>
                        <ul style="margin-bottom: 0;">
                            <li>A: æ™‚é–“æˆ³è¨˜</li>
                            <li>B: LINE ID</li>
                            <li>C: ä½œå“å…§å®¹</li>
                            <li>D: å››å­—è©•èª</li>
                            <li>E: æ–‡å­—å›é¥‹</li>
                            <li>F: èªéŸ³é€£çµ</li>
                        </ul>
                    </div>
                    <div class="card green">
                        <h4>è¨­å®šè®Šæ•¸æ¸…å–®</h4>
                        <ul style="margin-bottom: 0;">
                            <li>LINE_CHANNEL_ACCESS_TOKEN</li>
                            <li>SPREADSHEET_ID</li>
                            <li>SHEET_NAME</li>
                            <li>GEMINI_API_KEY</li>
                            <li>GOOGLE_CLOUD_API_KEY</li>
                            <li>DRIVE_FOLDER_ID</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 10: èª²ç¨‹ç¸½çµ -->
        <div class="slide">
            <div class="content-card" style="text-align: center;">
                <h2>ç¬¬äºŒæ¬¡èª²ç¨‹å®Œæˆï¼</h2>

                <div style="margin: 30px 0; padding: 25px; background: linear-gradient(135deg, #e1f5fe, #b3e5fc); border-radius: 15px;">
                    <h3 style="margin-bottom: 20px;">ä½ å·²ç¶“å®Œæˆçš„å¯¦ä½œï¼š</h3>
                    <div class="grid-3" style="text-align: left;">
                        <div class="card">
                            <h4>Part 7</h4>
                            <p style="margin-bottom: 0;">ä½¿ç”¨ Antigravity å»ºç«‹è©•é‡ç¶²ç«™</p>
                        </div>
                        <div class="card green">
                            <h4>Part 8</h4>
                            <p style="margin-bottom: 0;">LINE AI è©•èªæ©Ÿå™¨äººï¼ˆGAS + AI APIï¼‰</p>
                        </div>
                        <div class="card orange">
                            <h4>Part 9</h4>
                            <p style="margin-bottom: 0;">èªéŸ³è©•èªç³»çµ±ï¼ˆå››å­—è©•èª + TTSï¼‰</p>
                        </div>
                    </div>
                </div>

                <div class="step-box" style="max-width: 600px; margin: 25px auto; text-align: left;">
                    <h4>å­¸ç”Ÿæ”¶åˆ°çš„å®Œæ•´å›é¥‹ï¼š</h4>
                    <p style="margin: 0; font-family: monospace;">
                        ã€å››å­—è©•èªã€‘æ¢ç´¢æœªçŸ¥ãƒ»å‹‡æ–¼å˜—è©¦<br><br>
                        ã€è€å¸«å›é¥‹ã€‘ä½ çš„å ±å‘Šå±•ç¾äº†å°ç«æ˜Ÿæ¢æ¸¬çš„æ·±å…¥ç†è§£ï¼Œç‰¹åˆ¥æ˜¯èƒ½æºæ–¹æ¡ˆçš„åˆ†æå¾ˆæœ‰è¦‹åœ°ã€‚å»ºè­°å¯ä»¥å†è£œå……ä¸€äº›å¯¦éš›æ•¸æ“šä¾†æ”¯æŒä½ çš„è«–é»ã€‚<br><br>
                        ã€èªéŸ³ç‰ˆæœ¬ã€‘ğŸ”Š https://drive.google.com/...
                    </p>
                </div>

                <p style="font-size: 18px; color: #0277bd; margin-top: 30px;">
                    æ­å–œå®Œæˆæ‰€æœ‰å¯¦ä½œï¼<br>
                    ç¾åœ¨ä½ å¯ä»¥ç‚ºå­¸ç”Ÿæä¾›æœ‰æº«åº¦çš„ AI å­¸ç¿’å›é¥‹äº† ğŸ‰
                </p>
            </div>
        </div>
    </div>

    <div class="progress-indicator"></div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;

        function createProgressDots() {
            const container = document.querySelector('.progress-indicator');
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.className = 'progress-dot' + (i === 0 ? ' active' : '');
                dot.onclick = () => goToSlide(i);
                container.appendChild(dot);
            }
        }

        function updateProgress() {
            document.querySelectorAll('.progress-dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlide);
            });
        }

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.toggle('active', i === index);
            });
            updateProgress();
            document.querySelector('.prev-arrow').disabled = index === 0;
            document.querySelector('.next-arrow').disabled = index === totalSlides - 1;
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                currentSlide--;
                showSlide(currentSlide);
            }
        }

        function goToSlide(index) {
            currentSlide = index;
            showSlide(currentSlide);
        }

        function copyCode(btn) {
            const codeBox = btn.parentElement;
            const code = codeBox.innerText.replace('è¤‡è£½', '').trim();
            navigator.clipboard.writeText(code);
            btn.textContent = 'å·²è¤‡è£½!';
            setTimeout(() => btn.textContent = 'è¤‡è£½', 2000);
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ') nextSlide();
            if (e.key === 'ArrowLeft') prevSlide();
        });

        createProgressDots();
        showSlide(0);

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
    </script>
</body>
</html>
